<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Админ Панел - urtuuch.mn</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
body{font-family:sans-serif;background:#f0f5f5;margin:0;padding:0;}
.container{max-width:1000px;margin:20px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
h2{margin-top:0;}
input, select, textarea{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;}
button{padding:8px 12px;margin-top:5px;border:none;border-radius:5px;background:#3d85c6;color:#fff;cursor:pointer;}
button:hover{background:#6fa8dc;}
.table{width:100%;border-collapse:collapse;margin-top:15px;}
.table th,.table td{border:1px solid #ccc;padding:8px;text-align:left;}
.table th{background:#f4f4f4;}
.action-btn{margin-right:5px;}
</style>
</head>
<body>

<div class="container">
  <h2>Нийтлэлчид (Authors)</h2>
  <div>
    <input type="text" id="authorName" placeholder="Нэр">
    <input type="text" id="authorTitle" placeholder="Албан тушаал">
    <input type="text" id="authorImage" placeholder="Зураг URL">
    <button onclick="addAuthor()">Нэмэх</button>
  </div>
  <table class="table" id="authorsTable">
    <thead><tr><th>ID</th><th>Нэр</th><th>Албан тушаал</th><th>Зураг</th><th>Үйлдэл</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<div class="container">
  <h2>Мэдээ (News)</h2>
  <div>
    <input type="text" id="newsTitle" placeholder="Гарчиг">
    <textarea id="newsDescription" placeholder="Агуулга"></textarea>
    <input type="text" id="newsImage" placeholder="Зураг URL">
    <select id="newsCategory">
      <option value="Улс төр">Улс төр</option>
      <option value="Эдийн засаг">Эдийн засаг</option>
      <option value="Соёл урлаг">Соёл урлаг</option>
      <option value="Медиа">Медиа</option>
      <option value="Дэлхий дахинд">Дэлхий дахинд</option>
      <option value="Ярилцлага">Ярилцлага</option>
    </select>
    <label><input type="checkbox" id="newsFeatured"> Онцлох мэдээ</label>
    <select id="newsAuthor"></select>
    <button onclick="addNews()">Нэмэх</button>
  </div>
  <table class="table" id="newsTable">
    <thead><tr><th>ID</th><th>Гарчиг</th><th>Категори</th><th>Нийтлэлч</th><th>Онцлох</th><th>Үйлдэл</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<script>
const SUPABASE_URL = "https://wpotnvekaoosdkvmhqgo.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indwb3RudmVrYW9vc2Rrdm1ocWdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMTU3NjQsImV4cCI6MjA4MDU5MTc2NH0.YIpy_IA9nNseYUJB3Y-adxgv9btgAt5IKP5FJpafNC0";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let authors = [];
let news = [];

// --- Authors ---
async function fetchAuthors(){
  const { data, error } = await supabase.from('authors').select('*').order('id');
  if(error) return console.error(error);
  authors = data;
  renderAuthors();
  renderAuthorOptions();
}

function renderAuthors(){
  const tbody = document.querySelector("#authorsTable tbody");
  tbody.innerHTML = authors.map(a=>`
    <tr>
      <td>${a.id}</td>
      <td>${a.name}</td>
      <td>${a.title}</td>
      <td><img src="${a.image}" width="50"/></td>
      <td>
        <button class="action-btn" onclick="deleteAuthor(${a.id})">Устгах</button>
      </td>
    </tr>
  `).join('');
}

function renderAuthorOptions(){
  const select = document.getElementById('newsAuthor');
  select.innerHTML = authors.map(a=>`<option value="${a.id}">${a.name}</option>`).join('');
}

async function addAuthor(){
  const name = document.getElementById('authorName').value;
  const title = document.getElementById('authorTitle').value;
  const image = document.getElementById('authorImage').value;
  if(!name) return alert("Нэр оруулна уу");
  const { data, error } = await supabase.from('authors').insert([{name,title,image}]);
  if(error) return console.error(error);
  fetchAuthors();
}

// --- Delete author ---
async function deleteAuthor(id){
  if(!confirm("Устгах уу?")) return;
  const { error } = await supabase.from('authors').delete().eq('id', id);
  if(error) return console.error(error);
  fetchAuthors();
}

// --- News ---
async function fetchNews(){
  const { data, error } = await supabase.from('news').select('*').order('created_at', {ascending:false});
  if(error) return console.error(error);
  news = data;
  renderNews();
}

function renderNews(){
  const tbody = document.querySelector("#newsTable tbody");
  tbody.innerHTML = news.map(n=>{
    const author = authors.find(a=>a.id===n.author_id);
    return `<tr>
      <td>${n.id}</td>
      <td>${n.title}</td>
      <td>${n.category}</td>
      <td>${author?author.name:"Тодорхойгүй"}</td>
      <td>${n.featured?"Тийм":"Үгүй"}</td>
      <td>
        <button class="action-btn" onclick="deleteNews(${n.id})">Устгах</button>
      </td>
    </tr>`;
  }).join('');
}

async function addNews(){
  const title = document.getElementById('newsTitle').value;
  const description = document.getElementById('newsDescription').value;
  const image = document.getElementById('newsImage').value;
  const category = document.getElementById('newsCategory').value;
  const featured = document.getElementById('newsFeatured').checked;
  const author_id = parseInt(document.getElementById('newsAuthor').value);
  if(!title || !description) return alert("Гарчиг болон агуулга оруулна уу");
  const { data, error } = await supabase.from('news').insert([{title,description,image,category,featured,author_id}]);
  if(error) return console.error(error);
  fetchNews();
}

// --- Delete news ---
async function deleteNews(id){
  if(!confirm("Устгах уу?")) return;
  const { error } = await supabase.from('news').delete().eq('id', id);
  if(error) return console.error(error);
  fetchNews();
}

// --- Init ---
async function init(){
  await fetchAuthors();
  await fetchNews();
}
init();
</script>

</body>
</html>
