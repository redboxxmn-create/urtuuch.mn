<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>urtuuch.mn</title>
    <link rel="icon" type="image/png" href="https://wpotnvekaoosdkvmhqgo.supabase.co/storage/v1/object/public/news_images/1765287786830_37k2pwz.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ---------------------------------------------------------------------- */
        /* –ï–†”®–ù–•–ò–ô –°–¢–ò–õ–¨ (CSS) */
        /* ---------------------------------------------------------------------- */
        body{font-family:'Ubuntu',sans-serif; margin:0; padding:0; background:#f0f5f5; color:#333;}
        header{background:#fff; padding:10px 15px; position:sticky; top:0; box-shadow:0 2px 10px rgba(0,0,0,0.1); z-index:100; display:flex; flex-direction:column;}
        .search-box input{width:100%; padding:8px 12px; border-radius:8px; border:1px solid #ccc; margin:10px 0; font-size:14px; box-sizing:border-box;}
        .logo-container img { max-height: 40px; margin: 10px 0; object-fit: contain; width: auto;}
        nav {background:#3d85c6; display:flex; flex-wrap:wrap; padding:10px;}
        nav ul {list-style:none; margin:0; padding:0; display:flex; flex-wrap:wrap;}
        nav ul li {position:relative; margin-right:20px;}
        nav ul li a {color:#fff; text-decoration:none; padding:8px 12px; display:block; font-weight:bold; border-radius:6px; transition: background 0.3s ease;}
        nav ul li:hover > a {background:#6fa8dc;}
        nav ul li ul {display:none; position:absolute; top:100%; left:0; background:#6fa8dc; list-style:none; padding:0; margin:0; border-radius:6px; min-width:180px; z-index:100;}
        nav ul li:hover ul {display:block;}
        nav ul li ul li a {padding:8px 12px; color:#fff; text-decoration:none; display:block;}
        nav ul li ul li a:hover {background:#3d85c6;}
        
        /* –ú–≠–î–≠–≠–ù–ò–ô GRID –ë–û–õ–û–ù –ö–ê–†–¢–´–ù –ó–ê–ì–í–ê–† (–ó—É—Ä–∞–≥ –î–∞–≤—Ö–∞—Ä–ª–∞—Ö) */
        .grid{display:grid; grid-template-columns: repeat(4, 1fr); gap:15px; padding: 15px;}
        .card{cursor:pointer; border-radius:6px; overflow:hidden; box-shadow:0 3px 10px rgba(0,0,0,0.08); position:relative; transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; background:#fff; text-decoration: none; color: inherit; border: 1px solid #eee; display: block; min-height: 250px;}
        .card:hover{transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.15);}
        .card img{width:100%; height:100%; object-fit:cover; filter: brightness(0.8); transition: filter 0.3s ease; position: absolute; top: 0; left: 0; z-index: 1;}
        .card:hover img {filter: brightness(0.65);}
        .card-content{padding:15px; position:absolute; bottom:0; left: 0; width: 100%; color: #fff; z-index: 2; background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0) 50%); box-sizing: border-box; min-height: 80px; max-height: 100%;}
        .card-title{font-size:16px; margin:0; font-weight:bold; line-height: 1.3;}
        .card-meta{font-size:12px; color:#ddd; margin-top:5px; display:flex; justify-content:space-between; flex-wrap:wrap;}
        .card-meta span.category{background:#3d85c6; color:#fff; padding:2px 8px; border-radius:6px; font-size:12px;}
        .sub-featured-card {grid-column: span 2;}
        .sub-featured-card .card-title {font-size: 20px;}

        /* –û–ù–¶–õ–û–• –ú–≠–î–≠–≠–ù–ò–ô –ó–ê–ì–í–ê–† (Featured Block) */
        .featured-block-container {grid-column: 1 / -1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; padding: 15px; background: #f0f5f5; border-radius: 12px; box-shadow: none; position: relative;}
        .featured-block-container::before {content: "–®–£–£–†–•–ê–ô"; position: absolute; top: 0; left: 15px; background: #d9534f; color: #fff; padding: 5px 15px; border-radius: 8px 8px 0 0; font-weight: bold; font-size: 14px; z-index: 10;}
        .featured-main-card {grid-column: span 2; min-height: 350px; border: none; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-radius: 6px; overflow: hidden; position: relative; background: #fff; text-decoration: none; color: inherit;}
        .featured-main-card img {width: 100%; height: 100%; object-fit: cover; filter: brightness(0.75); position: absolute; top: 0; left: 0; z-index: 1;}
        .featured-main-card .card-content {position: absolute; bottom: 0; left: 0; width: 100%; color: #fff; padding: 20px; min-height: 100px; background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0) 60%); box-sizing: border-box; z-index: 2;}
        .featured-main-card .card-title {font-size: 20px; margin-bottom: 10px; font-weight: bold;}
        .featured-main-card .card-meta {color: #eee; margin-top: 10px;}
        .featured-main-card .card-meta span.category {background: #e74c3c; padding: 5px 10px; font-size: 14px;}
        .featured-main-card:hover {transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.15);}
        .featured-sidebar {grid-column: span 2; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;}
        .featured-sidebar .card {min-height: 167.5px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border: none;}
        .featured-sidebar .card img {filter: brightness(0.85); height: 100%;}
        .featured-sidebar .card .card-content {padding: 10px; min-height: 60px;}
        .featured-sidebar .card .card-title {font-size: 13px; margin-bottom: 5px; line-height: 1.2;}
        .featured-sidebar .card .card-meta {margin-top: 5px; display: none;}
        
        /* –•–ê–ú–ì–ò–ô–ù –î–û–û–†–• –¢–û–ú –í–ò–î–ï–û –ö–ê–†–¢–ù–´ –ó–ê–ì–í–ê–† */
        .video-card-bottom {grid-column: 1 / -1; padding: 20px 15px; margin: 20px 0; background: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);}
        .video-card-bottom h3 {font-size: 24px; margin-bottom: 15px; color: #3d85c6; border-bottom: 2px solid #3d85c6; padding-bottom: 5px;}
        .video-card-bottom iframe {width: 100%; height: 450px; border: none; border-radius: 12px;}
        
        /* –ê–ù–ì–ò–õ–õ–´–ù –¢–ê–ë –°–¢–ò–õ–¨ */
        .category-tabs {display: flex; flex-wrap: wrap; gap: 10px;}
        .tab-button {padding: 10px 15px; border: 1px solid #ccc; border-radius: 6px; background: #f0f0f0; cursor: pointer; font-weight: bold; transition: background 0.2s, color 0.2s; white-space: nowrap;}
        .tab-button:hover {background: #e0e0e0;}
        .tab-button.active {background: #3d85c6; color: #fff; border-color: #3d85c6;}
        
        /* SIDEBAR (–°“Ø“Ø–ª–∏–π–Ω “Ø–µ–∏–π–Ω –º—ç–¥—ç—ç) –ó–ê–ì–í–ê–† */
        #allNewsSection {display: grid !important; grid-template-columns: 3fr 1fr; gap: 20px; padding: 15px;}
        .main-content-area {grid-column: 1 / 2; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; align-content: start;}
        .sidebar-container {grid-column: 2 / 3; background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 10px rgba(0,0,0,0.05); align-self: start;}
        .sidebar-container h3 {font-size: 18px; color: #3d85c6; border-bottom: 3px solid #3d85c6; padding-bottom: 8px; margin-top: 0; margin-bottom: 15px; font-weight: bold;}
        .latest-news-item {padding: 10px 0; border-bottom: 1px dashed #eee; transition: background 0.2s; display: flex; gap: 10px; align-items: flex-start; cursor: pointer;}
        .latest-news-item:last-child {border-bottom: none;}
        .latest-news-item:hover {background: #fcfcfc;}
        .sidebar-img-wrapper {flex-shrink: 0; width: 70px; height: 70px; border-radius: 4px; overflow: hidden;}
        .sidebar-img-wrapper img {width: 100%; height: 100%; object-fit: cover; display: block;}
        .sidebar-content-wrapper {flex-grow: 1;}
        .latest-news-item a {text-decoration: none; color: #333; font-size: 13px; font-weight: bold; line-height: 1.4; display: block; transition: color 0.2s;}
        .latest-news-item a:hover {color: #e74c3c; text-decoration: underline;}
        .latest-news-item span {display: block; font-size: 11px; color: #999; margin-top: 3px;}
        
        /* –ë–£–°–ê–î –¢–£–°–õ–ê–• –ó–ê–ì–í–ê–†–£–£–î */
        .category-section {display: none;}
        .category-section.active {display: block;}
        .authors-container {display:flex; gap:10px; padding:15px; justify-content:center; flex-wrap:wrap; background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); margin: 15px;}
        .author-card {flex:1 1 80px; max-width:120px; text-align:center; padding:10px; border-radius:8px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s;}
        .author-card:hover {transform: translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.15);}
        .author-card img {width:50px; height:50px; border-radius:50%; object-fit:cover;}
        .author-name{font-weight:bold; font-size:14px;}
        .author-title{font-size:12px; color:#555;}
        .pagination{display:flex; justify-content:center; gap:5px; margin:10px 0; flex-wrap:wrap;}
        .pagination button{padding:5px 10px; border-radius:5px; border:none; background:#6fa8dc; color:#fff; cursor:pointer; transition:0.3s;}
        .pagination button:hover{background:#3d85c6;}
        .contact{background:#fff; padding:15px 10px; text-align:center; margin:15px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
        
        /* Modal */
        #newsModal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000;}
        #newsModalContent {background:#fff; border-radius:12px; max-width:700px; width:90%; max-height:80%; overflow:auto; padding:25px; position:relative;}
        #newsModalClose {position:absolute; top:10px; right:15px; cursor:pointer; font-weight:bold; font-size:24px; color: #333;}
        #newsModalContent img#modalImage{width:100%; max-height:300px; object-fit:cover; border-radius:8px; margin-bottom:15px; display: block;} 
        #modalContent p, #modalContent h1, #modalContent h2, #modalContent h3 { line-height: 1.6; margin-bottom: 15px;}
        .modal-video-container {margin: 15px 0; background: #000; border-radius: 8px; overflow: hidden;}
        
        /* –ì–ê–† –£–¢–ê–°–ù–´ –ó–ê–ì–í–ê–† (MEDIA QUERY) */
        @media(max-width:992px){
            .featured-block-container {grid-template-columns: 2fr 2fr;}
            .featured-main-card {grid-column: span 2;}
            .featured-sidebar {grid-column: span 2; grid-template-columns: 1fr 1fr;}
            .video-card-bottom iframe {height: 350px;}
        }
        @media(max-width:768px){
            .category-section.active { padding: 10px;}
            #allNewsSection {grid-template-columns: 1fr; gap: 10px;}
            .main-content-area {grid-column: 1 / -1; grid-template-columns: 1fr; padding: 0 5px;}
            .sidebar-container {grid-column: 1 / -1; margin: 10px 15px; order: 3;}
            .sidebar-img-wrapper {width: 80px; height: 60px;}
            #newsModalContent { max-width: 95%; max-height: 90%; }
            .video-card-bottom iframe {height: 250px;}
            .video-card-bottom h3 {font-size: 20px;}
            .featured-block-container {grid-template-columns: 1fr; gap: 10px; padding: 10px;}
            .featured-main-card {grid-column: 1 / -1; min-height: 250px;}
            .featured-sidebar {grid-column: 1 / -1; grid-template-columns: 1fr;}
            .featured-sidebar .card {min-height: 100px;}
            .card {display: block; max-width: none; min-height: 200px;}
            .card-content {padding: 10px; max-width: none;}
            .card-title {font-size: 14px;}
            .card-meta {display: flex;}
        }
    </style>
</head>
<body>
<header>
    <a href="index.html" class="logo-container">
        <img src="https://wpotnvekaoosdkvmhqgo.supabase.co/storage/v1/object/public/news_images/1765287786830_37k2pwz.png" alt="urtuuch.mn –ª–æ–≥–æ">
    </a>
    
    <div class="search-box"><input type="text" placeholder="–•–∞–π—Ö —É—Ç–≥–∞ –æ—Ä—É—É–ª–Ω–∞ —É—É!" id="searchInput"></div>
    <nav>
        <ul>
            <li><a href="#">–£–ª—Å —Ç”©—Ä</a>
                <ul><li><a href="#">–¢–æ–π–º</a></li><li><a href="#">–ù–∏–π—Ç–ª—ç–ª</a></li><li><a href="#">–°—É—Ä–≤–∞–ª–∂–∏–ª–≥–∞</a></li><li><a href="#">”®—Ä—Ç”©”©—á–∏–π–Ω “Ø–≥</a></li><li><a href="#">–•–æ–≤ –±–æ–ª–æ—Ö –≤–∏–π</a></li></ul>
            </li>
            <li><a href="#">–≠–¥–∏–π–Ω –∑–∞—Å–∞–≥</a>
                <ul><li><a href="#">–£—É–ª —É—É—Ä—Ö–∞–π</a></li><li><a href="#">–î—ç–¥ –±“Ø—Ç—ç—Ü</a></li><li><a href="#">–ú–æ–Ω–≥–æ–ª–¥ “Ø–π–ª–¥–≤—ç—Ä–ª—ç–≤</a></li><li><a href="#">–ó–∞—Ä —Å—É—Ä—Ç–∞–ª—á–∏–ª–≥–∞–∞</a></li></ul>
            </li>
            <li><a href="#">–°–æ—ë–ª —É—Ä–ª–∞–≥</a>
                <ul><li><a href="#">–Ø—Ä–∏–ª—Ü–ª–∞–≥–∞</a></li><li><a href="#">–°—É—Ä–≤–∞–ª–∂–∏–ª–≥–∞</a></li><li><a href="#">–ö–∏–Ω–æ –µ—Ä—Ç”©–Ω—Ü</a></li><li><a href="#">–£—Ç–≥–∞ –∑–æ—Ö–∏–æ–ª</a></li><li><a href="#">–°–æ—ë–ª —Å—É–¥–ª–∞–ª</a></li></ul>
            </li>
            <li><a href="#">–ú–µ–¥–∏–∞</a>
                <ul><li><a href="#">–ù—ç–≤—Ç—Ä“Ø“Ø–ª—ç–≥</a></li><li><a href="#">–ú—ç–¥—ç—ç</a></li><li><a href="#">–°—É—Ä–≤–∞–ª–∂–∏–ª–≥–∞</a></li><li><a href="#">MIC UP</a></li><li><a href="#">–ó—É—Ä–∞–≥–ª–∞–ª</a></li><li><a href="#">”®—Ä—Ç”©”©—á”©”©—Å</a></li></ul>
            </li>
            <li><a href="#">–î—ç–ª—Ö–∏–π –¥–∞—Ö–∏–Ω–¥</a>
                <ul><li><a href="#">–£–ª—Å —Ç”©—Ä</a></li><li><a href="#">–¢–∞–Ω–∏–Ω –º—ç–¥—ç—Ö“Ø–π</a></li><li><a href="#">–®–∏–Ω–∂–ª—ç—Ö —É—Ö–∞–∞–Ω</a></li></ul>
            </li>
            <li><a href="#">–Ø—Ä–∏–ª—Ü–ª–∞–≥–∞</a>
                <ul><li><a href="#">–•”©—Ä”©–≥ —è—Ä–∏–ª—Ü–ª–∞–≥–∞</a></li><li><a href="#">–£–ª—Å —Ç”©—Ä–∏–π–Ω —è—Ä–∏–ª—Ü–ª–∞–≥–∞</a></li></ul>
            </li>
        </ul>
    </nav>
</header>

<div id="weatherContainer" style="background:#497a9f; color:#fff; padding:10px 15px; border-radius:8px; margin: 10px 15px; text-align: center; font-weight: bold; font-size: 16px;">
    <p id="weatherText">–¶–∞–≥ –∞–≥–∞–∞—Ä—ã–Ω –º—ç–¥—ç—ç —Ç–∞—Ç–∞–∂ –±–∞–π–Ω–∞...</p>
</div>

<div class="exchange-rate-block" style="padding: 10px 15px; margin: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
    <h3 style="margin: 0 0 10px 0; color: #3d85c6; font-size: 16px;">üíµ –ë–æ–¥–∏—Ç –¶–∞–≥–∏–π–Ω –í–∞–ª—é—Ç—ã–Ω –•–∞–Ω—à (USD)</h3>
    <div style="display: flex; justify-content: space-between; gap: 15px;">
        <div style="flex: 1; text-align: center; padding: 8px; border-right: 1px solid #eee;">
            <span style="font-size: 14px; color: #555;">‚ÇÆ –ú–¢:</span>
            <div id="rate-mnt-display" style="font-size: 18px; font-weight: bold; color: #28a745;">–¢–∞—Ç–∞–∂ –±–∞–π–Ω–∞...</div>
        </div>
        <div style="flex: 1; text-align: center; padding: 8px;">
            <span style="font-size: 14px; color: #555;">‚Ç¨ EUR:</span>
            <div id="rate-eur-display" style="font-size: 18px; font-weight: bold; color: #28a745;">–¢–∞—Ç–∞–∂ –±–∞–π–Ω–∞...</div>
        </div>
    </div>
</div>

<div class="category-tabs" id="categoryTabs" style="padding: 10px 15px; margin: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
    <button class="tab-button active" onclick="showCategory('all')">“Æ–Ω–¥—Å—ç–Ω (–ë“Ø—Ö –º—ç–¥—ç—ç)</button> 
</div>

<div class="category-content-wrapper" id="categoryContentWrapper">
    <div class="category-section active" id="allNewsSection" data-category="all">
        
        <div class="main-content-area">
            </div>

        <div class="sidebar-container" id="sidebarContainer">
            </div>
    </div>
    
    </div>


<div class="authors-container" id="authorsContainer"></div>

<div class="pagination" id="pagination" style="display: flex;"></div> 

<div class="video-card-bottom" id="videoContainer" style="display: none;"> 
    <h3 id="videoTitle">–û–Ω—Ü–ª–æ—Ö –í–∏–¥–µ–æ</h3>
    <iframe 
        src="" 
        allowfullscreen
    ></iframe>
</div>

<div class="contact">
    <h3>–•–æ–ª–±–æ–æ –±–∞—Ä–∏—Ö</h3>
    <p>–£—Ç–∞—Å: 94344777</p>
    <p>Face: urtuuch.mn</p>
    <p>–•–∞—è–≥: –ê—Ä–≤–∞–π—Ö—ç—ç—Ä —Ö–æ—Ç</p>
</div>

<div id="newsModal">
    <div id="newsModalContent">
        <span id="newsModalClose">&times;</span>
        <h2 id="modalTitle"></h2>
        <div id="modalMeta" style="color:#666; font-size:12px; margin-bottom:10px;"></div>
        
        <div id="modalShare" style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
            <span style="font-weight: bold; font-size: 14px; color: #555;">–•—É–≤–∞–∞–ª—Ü–∞—Ö:</span>
        </div>
        
        <img id="modalImage" src="">
        <div id="modalContent" style="line-height: 1.6;"></div> 
    </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.42.0/+esm';

const SUPABASE_URL = "https://wpotnvekaoosdkvmhqgo.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indwb3RudmVrYW9vc2Rrdm1ocWdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMTU3NjQsImV4cCI6MjA4MDU5MTc2NH0.YIpy_IA9nNseYUJB3Y-adxgv9btgAt5IKP5FJpafNC0";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let authorsData = [];
let newsData = [];
let currentPage = 1;
const NEWS_PER_PAGE = 12; 
const TOTAL_NEWS_LIMIT = 29; 

// OpenWeatherMap API –¢“Æ–õ–•“Æ“Æ–†
const OPENWEATHER_API_KEY = "b73211d51342848ae190f73b7ad3b667"; 
const defaultCity = "Ulaanbaatar"; 


// ===================================================================================
// –ê–ñ–ò–õ–õ–ê–• “Æ–ù–î–°–≠–ù –§–£–ù–ö–¶“Æ“Æ–î
// ===================================================================================

function getYouTubeEmbedHtml(videoUrl) {
    if (!videoUrl) return '';
    try {
        let videoId = null;
        const url = new URL(videoUrl);
        if (url.hostname.includes('youtube.com')) {
            videoId = url.searchParams.get('v');
        } else if (url.hostname === 'youtu.be') {
            videoId = url.pathname.substring(1);
        }
        if (!videoId) return '';
        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=0&controls=1&rel=0`;
        return `
            <div class="modal-video-container">
                <iframe 
                    style="width: 100%; height: 320px; border: none; border-radius: 8px;" 
                    src="${embedUrl}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>`;
    } catch (e) {
        return '';
    }
}

async function fetchAuthors() {
    const { data, error } = await supabase.from('authors').select('*').order('id');
    if(error) console.error("Authors fetch error:", error); 
    else authorsData = data;
}

async function fetchNews() {
    const { data, error } = await supabase.from('news')
        .select('*, card_type, video_link') 
        .eq('active', true) 
        .order('created_at',{ascending:false})
        .limit(TOTAL_NEWS_LIMIT); 
        
    if(error) console.error("News fetch error:", error); 
    else newsData = data;
}

function displayAuthors() {
    const container = document.getElementById('authorsContainer');
    if (!authorsData || authorsData.length === 0) return; 

    container.innerHTML = authorsData.map(a=>`
        <div class="author-card">
            <img src="${a.image || 'https://i.imgur.com/KqJv6N6.png'}" alt="${a.name}">
            <div class="author-name">${a.name}</div>
            <div class="author-title">${a.title}</div>
        </div>
    `).join('');
}

function createNewsCard(n, cardType) {
    const div = document.createElement('div'); 
    div.className = "card";
    div.onclick = () => openNewsModal(n); 

    if (cardType) {
        div.classList.add(cardType);
    }
    
    const isFeatured = n.featured && cardType !== 'featured_sidebar_small'; 
    const categoryText = (isFeatured ? '–û–ù–¶–õ–û–• | ' : '') + n.category;
    const categoryStyle = (isFeatured || cardType === 'featured_main') ? 'background: #e74c3c;' : ''; 

    const contentHtml = `
        <div class="card-content">
            <h3 class="card-title">${n.title}</h3>
            <div class="card-meta">
                <span class="category" style="${categoryStyle}">${categoryText}</span>
                <span>${new Date(n.created_at).toLocaleDateString('mn-MN')}</span>
            </div>
            ${cardType === 'featured_main' ? `<p style="color:#eee; margin-top:10px; font-size:14px;">${n.description ? n.description.replace(/<[^>]*>?/gm, '').substring(0, 150) + '...' : ''}</p>` : ''} 
        </div>
    `;
    
    div.innerHTML = `${n.image?`<img src="${n.image}" alt="${n.title}">`:''}${contentHtml}`;
    
    return div;
}

// ===================================================================================
// –ú–≠–î–≠–≠–ù–ò–ô –ö–û–ù–¢–ï–ù–¢–´–ì –£–î–ò–†–î–ê–•
// ===================================================================================

function generateCategoryTabs() {
    const tabsContainer = document.getElementById('categoryTabs');
    const contentWrapper = document.getElementById('categoryContentWrapper');
    
    const categories = [...new Set(newsData.map(n => n.category).filter(c => c && c.trim() !== ''))];
    
    categories.forEach(cat => {
        const cleanCatName = cat.replace(/[^a-zA-Z0-9]/g, '');
        
        const button = document.createElement('button');
        button.className = 'tab-button';
        button.innerText = cat;
        // –§—É–Ω–∫—Ü –Ω—å window.showCategory-–≥ –¥—É—É–¥–Ω–∞
        button.setAttribute('onclick', `window.showCategory('${cat.replace(/'/g, "\\'")}')`);
        tabsContainer.appendChild(button);
        
        const section = document.createElement('div');
        section.className = 'grid category-section'; 
        section.id = `${cleanCatName}Section`; 
        section.setAttribute('data-category', cat);
        contentWrapper.appendChild(section);
    });
}

function displayMainPage() {
    const mainContentArea = document.querySelector('#allNewsSection .main-content-area');
    mainContentArea.innerHTML = ''; 

    const featuredNews = newsData.filter(n => n.featured).slice(0, 5);
    if (featuredNews.length > 0) {
        const featuredBlock = document.createElement('div');
        featuredBlock.className = 'featured-block-container';

        if (featuredNews[0]) {
            const mainCard = createNewsCard(featuredNews[0], 'featured-main-card');
            featuredBlock.appendChild(mainCard);
        }

        const sidebar = document.createElement('div');
        sidebar.className = 'featured-sidebar';
        featuredNews.slice(1, 5).forEach(n => {
            const smallCard = createNewsCard(n, 'featured-sidebar-small');
            sidebar.appendChild(smallCard);
        });
        featuredBlock.appendChild(sidebar);
        
        mainContentArea.appendChild(featuredBlock);
    }
    
    const nonFeaturedNews = newsData.filter(n => !n.featured);
    const start = (currentPage - 1) * NEWS_PER_PAGE;
    const end = start + NEWS_PER_PAGE;
    const newsForPage = nonFeaturedNews.slice(start, end);
    
    newsForPage.forEach(n => {
        const cardType = n.card_type === 'sub_featured' ? 'sub-featured-card' : null;
        const cardElement = createNewsCard(n, cardType);
        mainContentArea.appendChild(cardElement);
    });
    
    displayPagination(nonFeaturedNews.length);
    displaySidebarNews();
}

function displayCategoryNews(categoryName, container) {
    container.innerHTML = '';
    const filteredNews = newsData.filter(n => n.category === categoryName);
    
    filteredNews.forEach(n => {
        const cardElement = createNewsCard(n);
        container.appendChild(cardElement);
    });
}

function displayPagination(totalNewsCount) {
    const totalPages = Math.ceil(totalNewsCount / NEWS_PER_PAGE);
    const paginationContainer = document.getElementById('pagination');
    paginationContainer.innerHTML = '';

    for (let i = 1; i <= totalPages; i++) {
        const button = document.createElement('button');
        button.textContent = i;
        button.classList.toggle('active', i === currentPage);
        button.onclick = () => {
            currentPage = i;
            displayMainPage();
            window.scrollTo(0, 0); 
        };
        paginationContainer.appendChild(button);
    }
}

function displaySidebarNews() {
    const sidebarContainer = document.getElementById('sidebarContainer');
    sidebarContainer.innerHTML = '<h3>–°“Ø“Ø–ª–∏–π–Ω “Æ–µ–∏–π–Ω –ú—ç–¥—ç—ç</h3>';
    
    const latestNews = newsData.slice(0, 5); 
    
    latestNews.forEach(n => {
        const item = document.createElement('div');
        item.className = 'latest-news-item';
        // –ú–æ–¥–∞–ª—å –Ω—ç—ç—Ö
        item.onclick = () => openNewsModal(n);
        
        const html = `
            <div class="sidebar-img-wrapper">
                ${n.image ? `<img src="${n.image}" alt="${n.title}">` : '<img src="https://i.imgur.com/KqJv6N6.png" alt="No image">'}
            </div>
            <div class="sidebar-content-wrapper">
                <a href="javascript:void(0)">${n.title}</a>
                <span>${new Date(n.created_at).toLocaleDateString('mn-MN')}</span>
            </div>
        `;
        item.innerHTML = html;
        sidebarContainer.appendChild(item);
    });
}

function displayVideoCard() {
    const videoContainer = document.getElementById('videoContainer');
    const videoTitle = document.getElementById('videoTitle');
    const iframe = videoContainer.querySelector('iframe');
    
    const videoNews = newsData.find(n => n.video_link);
    
    if (videoNews && videoNews.video_link) {
        try {
            const url = new URL(videoNews.video_link);
            let videoId = null;
            
            if (url.hostname.includes('youtube.com')) {
                videoId = url.searchParams.get('v');
            } else if (url.hostname === 'youtu.be') {
                videoId = url.pathname.substring(1);
            }

            if (videoId) {
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=0&controls=1&rel=0`;
                videoTitle.textContent = `‚ñ∂Ô∏è ${videoNews.title}`;
                videoContainer.style.display = 'block';
                return;
            }
        } catch (e) {
            console.warn("–í–∏–¥–µ–æ –ª–∏–Ω–∫ –±—É—Ä—É—É –±–∞–π–Ω–∞:", videoNews.video_link);
        }
    }
    videoContainer.style.display = 'none';
}


// ===================================================================================
// –ú–û–î–ê–õ–¨ –ë–û–õ–û–ù –¶–ê–ì –ê–ì–ê–ê–†–´–ù –ê–ñ–ò–õ–õ–ê–ì–ê–ê
// ===================================================================================

async function fetchWeather() {
    const weatherTextElement = document.getElementById('weatherText');
    const url = `https://api.openweathermap.org/data/2.5/weather?q=${defaultCity},mn&appid=${OPENWEATHER_API_KEY}&units=metric&lang=mn`;
    
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("–¶–∞–≥ –∞–≥–∞–∞—Ä—ã–Ω API –∞–ª–¥–∞–∞");
        
        const data = await response.json();
        
        const temp = data.main.temp.toFixed(0);
        const description = data.weather[0].description;
        const icon = data.weather[0].icon;
        
        weatherTextElement.innerHTML = `
            <img src="https://openweathermap.org/img/wn/${icon}.png" style="vertical-align: middle; height: 30px; margin-right: 5px;">
            ${data.name} —Ö–æ—Ç: ${temp}¬∞C, ${description.charAt(0).toUpperCase() + description.slice(1)}
        `;
        
    } catch (error) {
        console.error("–¶–∞–≥ –∞–≥–∞–∞—Ä—ã–Ω –º—ç–¥—ç—ç–≥ —Ç–∞—Ç–∞–∂ —á–∞–¥—Å–∞–Ω–≥“Ø–π:", error);
        weatherTextElement.textContent = "–¶–∞–≥ –∞–≥–∞–∞—Ä—ã–Ω –º—ç–¥—ç—ç–ª—ç–ª –æ–¥–æ–æ–≥–æ–æ—Ä —Ç–∞—Ç–∞—Ö –±–æ–ª–æ–º–∂–≥“Ø–π.";
    }
}


window.openNewsModal = function(newsItem) {
    const modal = document.getElementById('newsModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalMeta = document.getElementById('modalMeta');
    const modalContent = document.getElementById('modalContent');
    const modalClose = document.getElementById('newsModalClose');
    
    const author = authorsData.find(a=>a.id===newsItem.author_id) || {name:"–¢–æ–¥–æ—Ä—Ö–æ–π–≥“Ø–π"};
    
    modalTitle.textContent = newsItem.title;
    modalImage.src = newsItem.image || '';
    modalMeta.innerHTML = `
        <span style="font-weight: bold;">${newsItem.category}</span> | 
        ${author.name} | 
        ${new Date(newsItem.created_at).toLocaleString('mn-MN')}
    `;
    
    let contentHTML = '';
    if (newsItem.video_link) {
        contentHTML += getYouTubeEmbedHtml(newsItem.video_link);
    }
    contentHTML += newsItem.description;
    
    modalContent.innerHTML = contentHTML;
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';

    modalClose.onclick = closeNewsModal;
    modal.onclick = (e) => {
        if (e.target === modal) closeNewsModal();
    };
};

function closeNewsModal() {
    document.getElementById('newsModal').style.display = 'none';
    document.body.style.overflow = 'auto'; 
    const iframe = document.getElementById('modalContent').querySelector('iframe');
    if (iframe) {
        iframe.src = iframe.src; 
    }
}


// ===================================================================================
// –•–£–£–î–ê–° –≠–•–õ“Æ“Æ–õ–≠–•
// ===================================================================================

document.addEventListener('DOMContentLoaded', async () => {
    await Promise.all([fetchAuthors(), fetchNews(), fetchWeather()]);
    
    displayAuthors();
    generateCategoryTabs();
    
    window.showCategory('all'); // –ê–Ω—Ö–Ω—ã –∞—á–∞–∞–ª–ª–∞–∞—Ä “Ø–Ω–¥—Å—ç–Ω —Ö—É—É–¥—Å—ã–≥ —Ö–∞—Ä—É—É–ª–Ω–∞
});

window.showCategory = function(categoryName) {
    // –¢–∞–Ω—ã ”©–≥—Å”©–Ω showCategory —Ñ—É–Ω–∫—Ü
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.category-section').forEach(section => section.classList.remove('active'));
    document.getElementById('videoContainer').style.display = 'none';

    let activeTabButton = null;
    document.querySelectorAll('.tab-button').forEach(btn => {
        if (btn.innerText.includes(categoryName) || btn.getAttribute('onclick').includes(`'${categoryName.replace(/'/g, "\\'")}'`)) {
            activeTabButton = btn;
        }
    });

    if (activeTabButton) {
        activeTabButton.classList.add('active');
    }

    if (categoryName === 'all') {
        const allSection = document.getElementById('allNewsSection');
        allSection.classList.add('active');
        displayMainPage(); 
        document.getElementById('pagination').style.display = 'flex'; 
        displayVideoCard(); 
    } else {
        const cleanCatName = categoryName.replace(/[^a-zA-Z0-9]/g, '');
        const categorySection = document.getElementById(`${cleanCatName}Section`);
        
        if (categorySection) {
            categorySection.classList.add('active');
            displayCategoryNews(categoryName, categorySection);
        }
        document.getElementById('pagination').style.display = 'none';
    }
}
</script>

<script>
// FastForex API-–≥ –∞—à–∏–≥–ª–∞–Ω MNT, EUR-–∏–π–Ω —Ö–∞–Ω—à–∏–π–≥ —Ç–∞—Ç–∞–∂, HTML-–¥ —Ö–∞—Ä—É—É–ª–∞—Ö –∫–æ–¥.
const API_KEY = "ccfdb2fcac-0282c8907b-t73egx"; 
const API_URL = `https://api.fastforex.io/fetch-multi?from=USD&to=MNT,EUR&api_key=${API_KEY}`;
const REFRESH_INTERVAL = 300000; // 5 –º–∏–Ω—É—Ç

async function fetchAndDisplayRates() {
    const mntElement = document.getElementById("rate-mnt-display");
    const eurElement = document.getElementById("rate-eur-display");

    if (mntElement) mntElement.textContent = "–¢–∞—Ç–∞–∂ –±–∞–π–Ω–∞...";
    if (eurElement) eurElement.textContent = "–¢–∞—Ç–∞–∂ –±–∞–π–Ω–∞...";

    try {
        const response = await fetch(API_URL);
        
        if (!response.ok) {
            throw new Error(`–•–∞–Ω—à —Ç–∞—Ç–∞—Ö–∞–¥ HTTP –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞: ${response.status}`);
        }

        const data = await response.json(); 
        
        if (data && data.results) {
            
            const mntRate = data.results.MNT; 
            if (mntRate && mntElement) {
                mntElement.textContent = `‚ÇÆ ${mntRate.toFixed(2)}`;
            } else if (mntElement) {
                mntElement.textContent = "–ú—ç–¥—ç—ç–ª—ç–ª–≥“Ø–π";
            }

            const eurRate = data.results.EUR;
            if (eurRate && eurElement) {
                eurElement.textContent = `‚Ç¨ ${eurRate.toFixed(4)}`;
            } else if (eurElement) {
                 eurElement.textContent = "–ú—ç–¥—ç—ç–ª—ç–ª–≥“Ø–π";
            }

        } else {
            throw new Error("API-–∞–∞—Å —Ö“Ø—á–∏–Ω–≥“Ø–π ”©–≥”©–≥–¥”©–ª –∏—Ä–ª—ç—ç.");
        }

    } catch (error) {
        console.error('‚ö†Ô∏è –í–∞–ª—é—Ç—ã–Ω —Ö–∞–Ω—à–∏–π–≥ —Ç–∞—Ç–∞—Ö–∞–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞:', error);
        if (mntElement) mntElement.textContent = "–ê–ª–¥–∞–∞";
        if (eurElement) eurElement.textContent = "–ê–ª–¥–∞–∞";
    }
}

// –§—É–Ω–∫—Ü–∏–π–≥ –∞–∂–∏–ª–ª—É—É–ª–∞—Ö
document.addEventListener('DOMContentLoaded', () => {
    fetchAndDisplayRates(); 
    // –¢–æ–≥—Ç–º–æ–ª —Ö—É–≥–∞—Ü–∞–∞–Ω—ã –¥–∞—Ä–∞–∞ –¥–∞—Ö–∏–Ω –¥—É—É–¥–∞—Ö (–∞–≤—Ç–æ–º–∞—Ç —à–∏–Ω—ç—á–ª—ç–ª—Ç)
    setInterval(fetchAndDisplayRates, REFRESH_INTERVAL);
});

</script>

</body>
</html>
